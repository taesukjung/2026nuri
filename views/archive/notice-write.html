<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>공지사항 - NURIINFOS</title>

    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
        rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet" type="text/css">
    <link href="/css/sub.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="/css/nav-style.css">
    <script src="/js/jquery-1.10.1.min.js" type="text/javascript"></script>
    <meta name="GENERATOR" content="MSHTML 11.00.10570.1001">
    <!-- summernote Start -->
    <link rel="stylesheet" , href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <link href="/summernote/summernote-bs4.css" , rel="stylesheet">
    <link href="/stylesheets/bbs.css?ver=2019-12-16-002" ,rel="stylesheet">
    <script src="/summernote/summernote-bs4.min.js"></script>
</head>

<body>
    <!-- 공통 네비게이션 포함 -->
    <%- include('../layout/nav.html') %>

        <!-- 히어로 섹션 -->
        <section class="history-hero notice">
            <div class="history-hero-content">
                <h2 class="hero-label">공지사항 </h2>
                <h1 class="hero-title">기술의 중심에서 전하는 깊이 있는 정보, <br>누리인포스의 소식을 만나보세요.</h1>
            </div>
            <div class="scroll-down">
                <span>Scroll Down</span>
                <div class="arrow"></div>
            </div>
        </section>

        <section class="inquiry">
            <div class="inquiry-container">
                <div class="inquiry-header">
                    <h2 class="inquiry-title">공지사항 </h2>
                    <p class="inquiry-subtitle">솔루션 업데이트와 공식 소식을 통해 누리인포스의 최신 행보를 공유합니다.</p>
                </div>
            </div>
        </section>

        <section class="casestudy write">
            <div class="casestudy-info">
                <div class="contact">
                    <div class="news_write">
                        <form name="wform" method="post">
                            <div class="title_area info">
                                <div class="day">
                                    <select id="b_category" name="b_category" class="select_text_date">
                                        <option value="1" selected="">Solution</option>
                                        <option value="2">Service</option>
                                        <option value="3">Industries</option>
                                        <option value="4">채용</option>
                                        <option value="5">누리인포스</option>
                                    </select>
                                    <span>
                                        <input type="date" title="날짜" name="b_date" id="b_date" value=""
                                            placeholder="날짜" class="input_text_date">
                                    </span>
                                </div>
                                <p class="title"><input type="text" title="제목" name="b_subject" id="b_subject" value=""
                                        placeholder="제목을 입력하세요" class="input_text"></p>
                                <input type="hidden" id="b_id" name="b_id" value="<%=b_id%>">
                            </div>
                            <p class="write_info">
                                <!-- <textarea class="input_text" placeholder="내용을 입력하세요"></textarea> -->
                                <textarea name="b_text" id="summernote" value=""></textarea>
                            </p>
                        </form>
                    </div>
                    <div class="btn_area">
                        <span><a href="/archive/notice" class="line">취소</a></span>
                        <span class="fr"><a href="javascript:save();">저장</a></span>
                        <span class="fr" id="btn_del"><a href="javascript:del();" class="line">삭제</a></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer Section (Wrapped for styling match with Index) -->
        <div id="footer-section">
            <%- include('../layout/footer.html') %>
        </div>

        <script src="/js/sub.js" type="text/javascript"></script>
        <script>
            var toolbar = [
                ['style', ['bold', 'italic', 'underline', 'clear']],
                ['font', ['strikethrough', 'superscript', 'subscript']],
                ['fontsize', ['fontsize']],
                ['Font Style', ['fontname']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['height', ['height']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'hr']],
                ['view', ['fullscreen', 'codeview']],
                ['help', ['help']]
            ];
            $('#summernote').summernote({
                lang: 'ko-KR',
                placeholder: '본문을 작성해 주세요',
                toolbar: toolbar,
                codemirror: { // codemirror options
                    theme: 'monokai'
                },
                width: '100%',
                height: '300px',

                callbacks: {
                    onImageUpload: function (file, editor, welEditable) {
                        saveFile(file[0], editor, welEditable);
                    }
                }
            });

            $(function () {
                if ($("#b_id").val() != "") {
                    $.ajax({
                        url: '/bbs/getContent',
                        dataType: 'json',
                        type: 'GET',
                        data: {
                            "b_id": $("#b_id").val()
                        },
                        success: function (result) {
                            $("#b_category").val(result.BBS_LIST[0].b_category);
                            $("#b_date").val(result.BBS_LIST[0].b_date);
                            $("#b_subject").val(result.BBS_LIST[0].b_subject);
                            $("#summernote").summernote('code', result.BBS_LIST[0].b_text);
                        }
                    });
                } else {
                    $("#b_category").val("1");
                    $("#btn_del").hide();
                }

                $('ul#b_category_ul li a').click(function (e) {
                    var id = $(this).attr("id");
                    $("li a[href='a']").removeClass("on")
                    $("#" + id).addClass("on");

                    var arr = id.split("_");
                    $("#b_category").val(arr[1]);
                });
            });

            function save() {
                var data = validator();
                if (!data.flag) {
                    alert(data.msg);
                    return;
                }

                var f = document.wform;
                f.action = $("#b_id").val() == "" ? "/bbs/notice/insert" : "/bbs/notice/update";
                f.method = "post"
                f.submit();
            }

            function del() {
                if (confirm("삭제하시겠습니까?")) {
                    var f = document.wform;
                    f.action = "/bbs/notice/delete"
                    f.method = "post";
                    f.submit();
                } else {
                    return;
                }
            }

            function validator() {
                var data = {};
                var flag = true;
                var msg = "";

                if ($.trim($("#b_date").val()) == "")
                    msg = "날짜는 필수입력 값 입니다.";
                if ($.trim($("#b_subject").val()) == "")
                    msg = "제목은 필수입력 값 입니다.";

                data.flag = msg != "" ? flag = false : true;
                data.msg = msg;

                return data;
            }

            function saveFile(file) {
                var data = new FormData();
                data.append("file", file);

                $.ajax({
                    type: "POST",
                    url: "/upload/image",
                    type: 'POST',
                    data: data,
                    contentType: false,
                    processData: false, // Don't process the files
                    success: function (data) {
                        console.log("-----")
                        console.log(data.url)
                        var img = $("<img>").attr({ src: data.url, width: "100%" });
                        $('#summernote').summernote("insertNode", img[0]);
                        //$('#summernote').summernote("insertImage", data.url);
                    }
                });
            }
        </script>

</body>

</html>